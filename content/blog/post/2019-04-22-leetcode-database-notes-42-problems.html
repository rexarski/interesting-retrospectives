---
title: LeetCode Database Notes (42 Problems)
author: Qiū Ruì
date: '2019-04-22'
slug: leetcode-database-notes-42-problems
categories: []
tags:
  - SQL
  - LeetCode
output:
  blogdown::html_page:
    toc: true
    toc_depth: 2
meta_img: image/image.png
description: Description for the page.
---


<div id="TOC">
<ul>
<li><a href="#combine-two-tables">175. Combine Two Tables</a></li>
<li><a href="#second-highest-salary">176. Second Highest Salary</a></li>
<li><a href="#nth-highest-salary">177. Nth Highest Salary</a></li>
<li><a href="#rank-scores">178. Rank Scores</a></li>
<li><a href="#consecutive-numbers">180. Consecutive Numbers</a></li>
<li><a href="#employees-earning-more-than-their-managers">181. Employees Earning More Than Their Managers</a></li>
<li><a href="#duplicate-emails">182. Duplicate Emails</a></li>
<li><a href="#customers-who-never-order">183. Customers Who Never Order</a></li>
<li><a href="#department-highest-salary">184. Department Highest Salary</a></li>
<li><a href="#department-top-three-salaries">185. Department Top Three Salaries</a></li>
<li><a href="#delete-duplicate-emails">196. Delete Duplicate Emails</a></li>
<li><a href="#rising-temperature">197. Rising Temperature</a></li>
<li><a href="#trips-and-users">262. Trips and Users</a></li>
<li><a href="#median-employee-salary">569. Median Employee Salary</a></li>
<li><a href="#managers-with-at-least-5-direct-reports">570. Managers with at Least 5 Direct Reports</a></li>
<li><a href="#find-median-given-frequency-of-numbers">571. Find Median Given Frequency of Numbers</a></li>
<li><a href="#winning-candidates">574. Winning Candidates</a></li>
<li><a href="#employee-bonus">577. Employee Bonus</a></li>
<li><a href="#get-highest-answer-rate-question">578. Get Highest Answer Rate Question</a></li>
<li><a href="#find-cumulative-salary-of-an-employee">579. Find Cumulative Salary of an Employee</a></li>
<li><a href="#count-student-number-in-departments">580. Count Student Number in Departments</a></li>
<li><a href="#find-customer-referee">584. Find Customer Referee</a></li>
<li><a href="#investments-in-2016">585. Investments in 2016</a></li>
<li><a href="#customer-placing-the-largest-number-of-orders">586. Customer Placing the Largest Number of Orders</a></li>
<li><a href="#big-countries">595. Big Countries</a></li>
<li><a href="#classes-more-than-5-students">596. Classes More Than 5 Students</a></li>
<li><a href="#friend-requests-i-overall-acceptance-rate">597. Friend Requests I: Overall Acceptance Rate</a></li>
<li><a href="#human-trafic-of-stadium">601. Human Trafic of Stadium</a></li>
<li><a href="#friend-requests-ii-who-has-the-most-friends">602. Friend Requests II: Who Has the Most Friends</a></li>
<li><a href="#consecutive-available-seats">603. Consecutive Available Seats</a></li>
<li><a href="#sales-person">607. Sales Person</a></li>
<li><a href="#tree-node">608. Tree Node</a></li>
<li><a href="#triangle-judgement">610. Triangle Judgement</a></li>
<li><a href="#shortest-distance-in-a-plane">612. Shortest Distance in a Plane</a></li>
<li><a href="#shortest-distance-in-a-line">613. Shortest Distance in a Line</a></li>
<li><a href="#second-degree-follower">614. Second Degree Follower</a></li>
<li><a href="#average-salary-departments-vs-company">615. Average Salary: Departments VS Company</a></li>
<li><a href="#students-report-by-geography">618. Students Report By Geography</a></li>
<li><a href="#biggest-single-number">619. Biggest Single Number</a></li>
<li><a href="#not-boring-movies">620. Not Boring Movies</a></li>
<li><a href="#exchange-seats">626. Exchange Seats</a></li>
<li><a href="#swap-salary">627. Swap Salary</a></li>
</ul>
</div>

<p><strong><em>Updated on 2019-04-26.</em></strong></p>
<p>✅ #175 ✅ #176 ✅ #177 ✅ #178 ✅ #180 ✅ #181 ✅ #182 ✅ #183 ✅ #184 ✅ #185 ✅ #196 ✅ #197 ✅ #262 ❌ #569 ❌ #570 ❌ #571 ❌ #574 ❌ #577 ❌ #578 ❌ #579 ❌ #580 ❌ #584 ❌ #585 ❌ #586 ✅ #595 ✅ #596 ❌ #597 ✅ #601 ❌ #602 ❌ #603 ❌ #607 ❌ #608 ❌ #610 ❌ #612 ❌ #613 ❌ #614 ❌ #615 ❌ #618 ❌ #619 ✅ #620 ✅ #626 ✅ #627</p>
<div id="combine-two-tables" class="section level2">
<h2>175. Combine Two Tables</h2>
<p>Table: <code>Person</code></p>
<pre><output>
+-------------+---------+
| Column Name | Type    |
+-------------+---------+
| PersonId    | int     |
| FirstName   | varchar |
| LastName    | varchar |
+-------------+---------+
</output></pre>
<p><code>PersonId</code> is the primary key column for this table.</p>
<p>Table: <code>Address</code></p>
<pre>
+-------------+---------+
| Column Name | Type    |
+-------------+---------+
| AddressId   | int     |
| PersonId    | int     |
| City        | varchar |
| State       | varchar |
+-------------+---------+
</pre>
<p><code>AddressId</code> is the primary key column for this table.</p>
<p>Write a SQL query for a report that provides the following information for each person in the Person table, regardless if there is an address for each of those people:</p>
<pre><code>FirstName, LastName, City, State</code></pre>
<div id="solution" class="section level3">
<h3>Solution</h3>
<pre class="mysql"><code>SELECT FirstName, LastName, City, State
FROM Person 
LEFT JOIN Address ON Person.PersonId = Address.PersonId;</code></pre>
<p>Note: There is no <code>FULL JOIN</code> in MySQL.</p>
</div>
</div>
<div id="second-highest-salary" class="section level2">
<h2>176. Second Highest Salary</h2>
<p>Write a SQL query to get the second highest salary from the <code>Employee</code> table.</p>
<pre>
+----+--------+
| Id | Salary |
+----+--------+
| 1  | 100    |
| 2  | 200    |
| 3  | 300    |
+----+--------+
</pre>
<p>For example, given the above Employee table, the query should return <code>200</code> as the second highest salary. If there is no second highest salary, then the query should return <code>null</code>.</p>
<pre>
+---------------------+
| SecondHighestSalary |
+---------------------+
| 200                 |
+---------------------+
</pre>
<div id="solution-1" class="section level3">
<h3>Solution</h3>
<pre class="mysql"><code>SELECT MAX(Salary) as SecondHighestSalary
FROM Employee
WHERE Salary &lt; (SELECT MAX(Salary) FROM Employee);</code></pre>
</div>
</div>
<div id="nth-highest-salary" class="section level2">
<h2>177. Nth Highest Salary</h2>
<p>Write a SQL query to get the nth highest salary from the <code>Employee</code> table.</p>
<pre>
+----+--------+
| Id | Salary |
+----+--------+
| 1  | 100    |
| 2  | 200    |
| 3  | 300    |
+----+--------+
</pre>
<p>For example, given the above Employee table, the nth highest salary where n = 2 is <code>200</code>. If there is no nth highest salary, then the query should return <code>null</code>.</p>
<pre>
+------------------------+
| getNthHighestSalary(2) |
+------------------------+
| 200                    |
+------------------------+
</pre>
<div id="solution-2" class="section level3">
<h3>Solution</h3>
<pre class="mysql"><code>CREATE FUNCTION getNthHighestSalary(N INT) RETURNS INT
BEGIN
  SET N = N-1;
  RETURN (
      SELECT DISTINCT Salary FROM Employee ORDER BY Salary DESC LIMIT 1 OFFSET N 
  );
END</code></pre>
<p>The idea is to use <code>LIMIT</code> and <code>OFFSET</code> in MySQL to skip those first <code>N-1</code> higher salaries than the nth one you really need to pick out.</p>
</div>
</div>
<div id="rank-scores" class="section level2">
<h2>178. Rank Scores</h2>
<p>Write a SQL query to rank scores. If there is a tie between two scores, both should have the same ranking. Note that after a tie, the next ranking number should be the next consecutive integer value. In other words, there should be no “holes” between ranks.</p>
<pre>
+----+-------+
| Id | Score |
+----+-------+
| 1  | 3.50  |
| 2  | 3.65  |
| 3  | 4.00  |
| 4  | 3.85  |
| 5  | 4.00  |
| 6  | 3.65  |
+----+-------+
</pre>
<p>For example, given the above <code>Scores</code> table, your query should generate the following report (order by highest score):</p>
<pre>
+-------+------+
| Score | Rank |
+-------+------+
| 4.00  | 1    |
| 4.00  | 1    |
| 3.85  | 2    |
| 3.65  | 3    |
| 3.65  | 3    |
| 3.50  | 4    |
+-------+------+
</pre>
<div id="solution-3" class="section level3">
<h3>Solution</h3>
<pre class="mysql"><code>SELECT s.Score, COUNT(t.Score) as Rank FROM
(SELECT DISTINCT Score from Scores) AS t, Scores as s
WHERE s.Score &lt;= t.Score
GROUP BY s.Id, s.Score
ORDER BY s.Score DESC;</code></pre>
<p>The idea here is to use two <code>Scores</code> tables side-by-side, one used to keep track of scores, and one used to calculate the rank of them. Note that the rank is decided by <strong>how many other distinct scores you are higher than.</strong> After that, all you need to do is to group them by <code>Id</code> and <code>Score</code>, then order the scores by descending order.</p>
</div>
</div>
<div id="consecutive-numbers" class="section level2">
<h2>180. Consecutive Numbers</h2>
<p>Write a SQL query to find all numbers that appear at least three times consecutively.</p>
<pre>
+----+-----+
| Id | Num |
+----+-----+
| 1  |  1  |
| 2  |  1  |
| 3  |  1  |
| 4  |  2  |
| 5  |  1  |
| 6  |  2  |
| 7  |  2  |
+----+-----+
</pre>
<p>For example, given the above <code>Logs</code> table, <code>1</code> is the only number that appears consecutively for at least three times.</p>
<pre>
+-----------------+
| ConsecutiveNums |
+-----------------+
| 1               |
+-----------------+
</pre>
<div id="solution-4" class="section level3">
<h3>Solution</h3>
<pre class="mysql"><code>SELECT DISTINCT
    l1.Num AS ConsecutiveNums
FROM
    Logs l1,
    Logs l2,
    Logs l3
WHERE
    l1.Id = l2.Id - 1
    AND l2.Id = l3.Id - 1
    AND l1.Num = l2.Num
    AND l2.Num = l3.Num
;</code></pre>
<p>Just keep in your mind that what constitutes a record of 3 consecutive numbers?</p>
<ol style="list-style-type: decimal">
<li>Consecutive <code>Id</code>s.</li>
<li>The same <code>Num</code>.</li>
</ol>
</div>
</div>
<div id="employees-earning-more-than-their-managers" class="section level2">
<h2>181. Employees Earning More Than Their Managers</h2>
<p>The <code>Employee</code> table holds all employees including their managers. Every employee has an Id, and there is also a column for the manager Id.</p>
<pre>
+----+-------+--------+-----------+
| Id | Name  | Salary | ManagerId |
+----+-------+--------+-----------+
| 1  | Joe   | 70000  | 3         |
| 2  | Henry | 80000  | 4         |
| 3  | Sam   | 60000  | NULL      |
| 4  | Max   | 90000  | NULL      |
+----+-------+--------+-----------+
</pre>
<p>Given the <code>Employee</code> table, write a SQL query that finds out employees who earn more than their managers. For the above table, Joe is the only employee who earns more than his manager.</p>
<pre>
+----------+
| Employee |
+----------+
| Joe      |
+----------+
</pre>
<div id="solution-5" class="section level3">
<h3>Solution</h3>
<pre class="mysql"><code>SELECT e1.Name as Employee
FROM Employee as e1
JOIN Employee as e2 on e1.ManagerId = e2.Id
WHERE e1.Salary &gt; e2.Salary;</code></pre>
</div>
</div>
<div id="duplicate-emails" class="section level2">
<h2>182. Duplicate Emails</h2>
<p>Write a SQL query to find all duplicate emails in a table named <code>Person</code>.</p>
<pre>
+----+---------+
| Id | Email   |
+----+---------+
| 1  | a@b.com |
| 2  | c@d.com |
| 3  | a@b.com |
+----+---------+
</pre>
<p>For example, your query should return the following for the above table:</p>
<pre>
+---------+
| Email   |
+---------+
| a@b.com |
+---------+
</pre>
<div id="solution-6" class="section level3">
<h3>Solution</h3>
<pre class="mysql"><code>SELECT Email
FROM Person
GROUP BY EMAIL
HAVING COUNT(*)&gt;1;</code></pre>
</div>
</div>
<div id="customers-who-never-order" class="section level2">
<h2>183. Customers Who Never Order</h2>
<p>Suppose that a website contains two tables, the <code>Customers</code> table and the <code>Orders</code> table. Write a SQL query to find all customers who never order anything.</p>
<p>Table: <code>Customers</code>.</p>
<pre>
+----+-------+
| Id | Name  |
+----+-------+
| 1  | Joe   |
| 2  | Henry |
| 3  | Sam   |
| 4  | Max   |
+----+-------+
</pre>
<p>Table: <code>Orders</code>.</p>
<pre>
+----+------------+
| Id | CustomerId |
+----+------------+
| 1  | 3          |
| 2  | 1          |
+----+------------+
</pre>
<p>Using the above tables as example, return the following:</p>
<pre>
+-----------+
| Customers |
+-----------+
| Henry     |
| Max       |
+-----------+
</pre>
<div id="solution-7" class="section level3">
<h3>Solution</h3>
<pre class="mysql"><code>SELECT Name AS Customers
FROM Customers
LEFT JOIN Orders
ON Customers.Id = Orders.CustomerId
WHERE Orders.Id IS NULL;</code></pre>
</div>
</div>
<div id="department-highest-salary" class="section level2">
<h2>184. Department Highest Salary</h2>
<p>The <code>Employee</code> table holds all employees. Every employee has an Id, a salary, and there is also a column for the department Id.</p>
<pre>
+----+-------+--------+--------------+
| Id | Name  | Salary | DepartmentId |
+----+-------+--------+--------------+
| 1  | Joe   | 70000  | 1            |
| 2  | Jim   | 90000  | 1            |
| 3  | Henry | 80000  | 2            |
| 4  | Sam   | 60000  | 2            |
| 5  | Max   | 90000  | 1            |
+----+-------+--------+--------------+
</pre>
<p>The <code>Department</code> table holds all departments of the company.</p>
<pre>
+----+----------+
| Id | Name     |
+----+----------+
| 1  | IT       |
| 2  | Sales    |
+----+----------+
</pre>
<p>Write a SQL query to find employees who have the highest salary in each of the departments. For the above tables, your SQL query should return the following rows (order of rows does not matter).</p>
<pre>
+------------+----------+--------+
| Department | Employee | Salary |
+------------+----------+--------+
| IT         | Max      | 90000  |
| IT         | Jim      | 90000  |
| Sales      | Henry    | 80000  |
+------------+----------+--------+
</pre>
<p>Explanation:</p>
<p>Max and Jim both have the highest salary in the IT department and Henry has the highest salary in the Sales department.</p>
<div id="solution-8" class="section level3">
<h3>Solution</h3>
<pre class="mysql"><code># inner join without a join
SELECT Department.Name as Department, Employee.Name as Employee, Employee.Salary
FROM Employee, Department
WHERE Employee.DepartmentId = Department.Id
    AND Employee.Salary = (
        SELECT MAX(Salary) FROM Employee AS temp WHERE temp.DepartmentId=Employee.DepartmentId
    );</code></pre>
</div>
</div>
<div id="department-top-three-salaries" class="section level2">
<h2>185. Department Top Three Salaries</h2>
<p>The <code>Employee</code> table holds all employees. Every employee has an Id, and there is also a column for the department Id.</p>
<table style="width:51%;">
<colgroup>
<col width="6%" />
<col width="11%" />
<col width="12%" />
<col width="20%" />
</colgroup>
<tbody>
<tr class="odd">
<td><p>Id</p></td>
<td><p>Name</p></td>
<td><p>Salary</p></td>
<td><p>DepartmentId</p></td>
</tr>
<tr class="even">
<td><p>1 2 3 4 5 6 7</p></td>
<td><p>Joe Henry Sam Max Janet Randy Will</p></td>
<td><p>85000 80000 60000 90000 69000 85000 70000</p></td>
<td><p>1 2 2 1 1 1 1</p></td>
</tr>
</tbody>
</table>
<p>The <code>Department</code> table holds all departments of the company.</p>
<table style="width:22%;">
<colgroup>
<col width="6%" />
<col width="15%" />
</colgroup>
<tbody>
<tr class="odd">
<td><p>Id</p></td>
<td><p>Name</p></td>
</tr>
<tr class="even">
<td><p>1 2</p></td>
<td><p>IT Sales</p></td>
</tr>
</tbody>
</table>
<p>Write a SQL query to find employees who earn the top three salaries in each of the department. For the above tables, your SQL query should return the following rows (order of rows does not matter).</p>
<pre>
+------------+----------+--------+
| Department | Employee | Salary |
+------------+----------+--------+
| IT         | Max      | 90000  |
| IT         | Randy    | 85000  |
| IT         | Joe      | 85000  |
| IT         | Will     | 70000  |
| Sales      | Henry    | 80000  |
| Sales      | Sam      | 60000  |
+------------+----------+--------+
</pre>
<p>Explanation:</p>
<p>In IT department, Max earns the highest salary, both Randy and Joe earn the second highest salary, and Will earns the third highest salary. There are only two employees in the Sales department, Henry earns the highest salary while Sam earns the second highest salary.</p>
<div id="solution-9" class="section level3">
<h3>Solution</h3>
<p><strong>Note:</strong> Top 3 highest (without order) means there are less than 3 people having higher salaries than him or her.</p>
<pre class="mysql"><code>SELECT
    d.Name AS &#39;Department&#39;, e1.Name AS &#39;Employee&#39;, e1.Salary
FROM
    Employee e1
        JOIN
    Department d ON e1.DepartmentId = d.Id
WHERE
    3 &gt; (SELECT
            COUNT(DISTINCT e2.Salary)
         FROM
            Employee e2
         WHERE
            e2.Salary &gt; e1.Salary
                AND e1.DepartmentId = e2.DepartmentID
        )
;</code></pre>
</div>
</div>
<div id="delete-duplicate-emails" class="section level2">
<h2>196. Delete Duplicate Emails</h2>
<p>Write a SQL query to delete all duplicate email entries in a table named <code>Person</code>, keeping only unique emails based on its smallest <code>Id</code>.</p>
<pre>
+----+------------------+
| Id | Email            |
+----+------------------+
| 1  | john@example.com |
| 2  | bob@example.com  |
| 3  | john@example.com |
+----+------------------+
</pre>
<p><code>Id</code> is the primary key column for this table.</p>
<p>For example, after running your query, the above <code>Person</code> table should have the following rows:</p>
<pre>
+----+------------------+
| Id | Email            |
+----+------------------+
| 1  | john@example.com |
| 2  | bob@example.com  |
+----+------------------+
</pre>
<p><strong>Note:</strong> Your output is the whole <code>Person</code> table after executing your sql. Use <code>delete</code> statement.</p>
<div id="solution-10" class="section level3">
<h3>Solution</h3>
<pre class="mysql"><code>DELETE p1 FROM Person AS p1
JOIN Person AS p2 ON p1.Email=p2.Email AND p1.Id&gt;p2.Id;</code></pre>
</div>
</div>
<div id="rising-temperature" class="section level2">
<h2>197. Rising Temperature</h2>
<p>Given a <code>Weather</code> table, write a SQL query to find all dates’ Ids with higher temperature compared to its previous (yesterday’s) dates.</p>
<pre>
+---------+------------------+------------------+
| Id(INT) | RecordDate(DATE) | Temperature(INT) |
+---------+------------------+------------------+
|       1 |       2015-01-01 |               10 |
|       2 |       2015-01-02 |               25 |
|       3 |       2015-01-03 |               20 |
|       4 |       2015-01-04 |               30 |
+---------+------------------+------------------+
</pre>
<p>For example, return the following Ids for the above <code>Weather</code> table:</p>
<pre>
+----+
| Id |
+----+
|  2 |
|  4 |
+----+
</pre>
<div id="solution-11" class="section level3">
<h3>Solution</h3>
<pre class="mysql"><code>SELECT w1.Id
FROM Weather AS w1, Weather AS w2
WHERE DATEDIFF(w1.RecordDate,w2.RecordDate)=1 AND w1.Temperature&gt;w2.Temperature;</code></pre>
<p><strong>Note:</strong> I first tried with <code>w1.RecordDate=w2.RecordDate+1</code>. It worked with some test cases, but failed in some. Seems that I need to take a look at datetime arithmetic in SQL later.</p>
</div>
</div>
<div id="trips-and-users" class="section level2">
<h2>262. Trips and Users</h2>
<p>The <code>Trips</code> table holds all taxi trips. Each trip has a unique Id, while Client_Id and Driver_Id are both foreign keys to the <code>Users_Id</code> at the Users table. Status is an ENUM type of (‘completed’, ‘cancelled_by_driver’, ‘cancelled_by_client’).</p>
<pre>
+----+-----------+-----------+---------+--------------------+----------+
| Id | Client_Id | Driver_Id | City_Id |        Status      |Request_at|
+----+-----------+-----------+---------+--------------------+----------+
| 1  |     1     |    10     |    1    |     completed      |2013-10-01|
| 2  |     2     |    11     |    1    | cancelled_by_driver|2013-10-01|
| 3  |     3     |    12     |    6    |     completed      |2013-10-01|
| 4  |     4     |    13     |    6    | cancelled_by_client|2013-10-01|
| 5  |     1     |    10     |    1    |     completed      |2013-10-02|
| 6  |     2     |    11     |    6    |     completed      |2013-10-02|
| 7  |     3     |    12     |    6    |     completed      |2013-10-02|
| 8  |     2     |    12     |    12   |     completed      |2013-10-03|
| 9  |     3     |    10     |    12   |     completed      |2013-10-03| 
| 10 |     4     |    13     |    12   | cancelled_by_driver|2013-10-03|
+----+-----------+-----------+---------+--------------------+----------+
</pre>
<p>The <code>Users</code> table holds all users. Each user has an unique Users_Id, and Role is an ENUM type of (‘client’, ‘driver’, ‘partner’).</p>
<pre>
+----------+--------+--------+
| Users_Id | Banned |  Role  |
+----------+--------+--------+
|    1     |   No   | client |
|    2     |   Yes  | client |
|    3     |   No   | client |
|    4     |   No   | client |
|    10    |   No   | driver |
|    11    |   No   | driver |
|    12    |   No   | driver |
|    13    |   No   | driver |
+----------+--------+--------+
</pre>
<p>Write a SQL query to find the cancellation rate of requests made by unbanned users between <strong>Oct 1, 2013</strong> and <strong>Oct 3, 2013</strong>. For the above tables, your SQL query should return the following rows with the cancellation rate being rounded to two decimal places.</p>
<pre>
+------------+-------------------+
|     Day    | Cancellation Rate |
+------------+-------------------+
| 2013-10-01 |       0.33        |
| 2013-10-02 |       0.00        |
| 2013-10-03 |       0.50        |
+------------+-------------------+
</pre>
<div id="solution-12" class="section level3">
<h3>Solution</h3>
<pre class="mysql"><code>SELECT
    Trips.Request_at As Day,
    round(sum(if(status != &#39;completed&#39;, 1, 0)) / sum(1), 2) AS &#39;Cancellation Rate&#39; 
FROM
    Trips 
JOIN
    Users ON Trips.Client_Id = Users.Users_Id
WHERE
    Users.Banned = &quot;No&quot;
    AND Trips.Request_at BETWEEN &quot;2013-10-01&quot; AND &quot;2013-10-03&quot;
GROUP BY
    Day;</code></pre>
</div>
</div>
<div id="median-employee-salary" class="section level2">
<h2>569. Median Employee Salary</h2>
</div>
<div id="managers-with-at-least-5-direct-reports" class="section level2">
<h2>570. Managers with at Least 5 Direct Reports</h2>
</div>
<div id="find-median-given-frequency-of-numbers" class="section level2">
<h2>571. Find Median Given Frequency of Numbers</h2>
</div>
<div id="winning-candidates" class="section level2">
<h2>574. Winning Candidates</h2>
</div>
<div id="employee-bonus" class="section level2">
<h2>577. Employee Bonus</h2>
</div>
<div id="get-highest-answer-rate-question" class="section level2">
<h2>578. Get Highest Answer Rate Question</h2>
</div>
<div id="find-cumulative-salary-of-an-employee" class="section level2">
<h2>579. Find Cumulative Salary of an Employee</h2>
</div>
<div id="count-student-number-in-departments" class="section level2">
<h2>580. Count Student Number in Departments</h2>
</div>
<div id="find-customer-referee" class="section level2">
<h2>584. Find Customer Referee</h2>
</div>
<div id="investments-in-2016" class="section level2">
<h2>585. Investments in 2016</h2>
</div>
<div id="customer-placing-the-largest-number-of-orders" class="section level2">
<h2>586. Customer Placing the Largest Number of Orders</h2>
</div>
<div id="big-countries" class="section level2">
<h2>595. Big Countries</h2>
<p>There is a table <code>World</code></p>
<pre>
+-----------------+------------+------------+--------------+---------------+
| name            | continent  | area       | population   | gdp           |
+-----------------+------------+------------+--------------+---------------+
| Afghanistan     | Asia       | 652230     | 25500100     | 20343000      |
| Albania         | Europe     | 28748      | 2831741      | 12960000      |
| Algeria         | Africa     | 2381741    | 37100000     | 188681000     |
| Andorra         | Europe     | 468        | 78115        | 3712000       |
| Angola          | Africa     | 1246700    | 20609294     | 100990000     |
+-----------------+------------+------------+--------------+---------------+
</pre>
<p>A country is big if it has an area of bigger than 3 million square km or a population of more than 25 million.</p>
<p>Write a SQL solution to output big countries’ name, population and area.</p>
<p>For example, according to the above table, we should output:</p>
<pre>
+--------------+-------------+--------------+
| name         | population  | area         |
+--------------+-------------+--------------+
| Afghanistan  | 25500100    | 652230       |
| Algeria      | 37100000    | 2381741      |
+--------------+-------------+--------------+
</pre>
<div id="solution-13" class="section level3">
<h3>Solution</h3>
<pre class="mysql"><code>select name, population, area
from World
where area &gt; 3000000 or population &gt; 25000000;</code></pre>
</div>
</div>
<div id="classes-more-than-5-students" class="section level2">
<h2>596. Classes More Than 5 Students</h2>
<p>There is a table <code>courses</code> with columns: <strong>student</strong> and <strong>class</strong></p>
<p>Please list out all classes which have more than or equal to 5 students.</p>
<p>For example, the table:</p>
<pre>
+---------+------------+
| student | class      |
+---------+------------+
| A       | Math       |
| B       | English    |
| C       | Math       |
| D       | Biology    |
| E       | Math       |
| F       | Computer   |
| G       | Math       |
| H       | Math       |
| I       | Math       |
+---------+------------+
</pre>
<p>Should output:</p>
<pre>
+---------+
| class   |
+---------+
| Math    |
+---------+
</pre>
<p><strong>Note:</strong> The students should not be counted duplicate in each course.</p>
<div id="solution-14" class="section level3">
<h3>Solution</h3>
<pre class="mysql"><code>select class
from (select
      class, count(DISTINCT student) as num
      from
      courses
      group by class) as temp_table
where num &gt;= 5;</code></pre>
</div>
</div>
<div id="friend-requests-i-overall-acceptance-rate" class="section level2">
<h2>597. Friend Requests I: Overall Acceptance Rate</h2>
</div>
<div id="human-trafic-of-stadium" class="section level2">
<h2>601. Human Trafic of Stadium</h2>
<p>X city built a new stadium, each day many people visit it and the stats are saved as these columns: <strong>id, visit_date, people</strong></p>
<p>Please write a query to display the records which have 3 or more consecutive rows and the amount of people more than 100(inclusive).</p>
<p>For example, the table <code>stadium</code>:</p>
<pre>
+------+------------+-----------+
| id   | visit_date | people    |
+------+------------+-----------+
| 1    | 2017-01-01 | 10        |
| 2    | 2017-01-02 | 109       |
| 3    | 2017-01-03 | 150       |
| 4    | 2017-01-04 | 99        |
| 5    | 2017-01-05 | 145       |
| 6    | 2017-01-06 | 1455      |
| 7    | 2017-01-07 | 199       |
| 8    | 2017-01-08 | 188       |
+------+------------+-----------+
</pre>
<p>For the sample data above, the output is:</p>
<pre>
+------+------------+-----------+
| id   | visit_date | people    |
+------+------------+-----------+
| 5    | 2017-01-05 | 145       |
| 6    | 2017-01-06 | 1455      |
| 7    | 2017-01-07 | 199       |
| 8    | 2017-01-08 | 188       |
+------+------------+-----------+
</pre>
<p><strong>Note:</strong> Each day only have one row record, and the dates are increasing with id increasing.</p>
<div id="solution-15" class="section level3">
<h3>Solution</h3>
<pre class="mysql"><code>select distinct t1.*
from stadium t1, stadium t2, stadium t3
where t1.people&gt;=100 and t2.people&gt;=100 and t3.people&gt;=100 and
(
(t1.id-t2.id=1 and t1.id-t3.id=2 and t2.id-t3.id=1)
or
(t2.id-t1.id=1 and t2.id-t3.id=2 and t1.id-t3.id=1)
or
(t3.id-t2.id=1 and t2.id-t1.id=1 and t3.id-t1.id=2)
)
order by t1.id;</code></pre>
</div>
</div>
<div id="friend-requests-ii-who-has-the-most-friends" class="section level2">
<h2>602. Friend Requests II: Who Has the Most Friends</h2>
</div>
<div id="consecutive-available-seats" class="section level2">
<h2>603. Consecutive Available Seats</h2>
</div>
<div id="sales-person" class="section level2">
<h2>607. Sales Person</h2>
</div>
<div id="tree-node" class="section level2">
<h2>608. Tree Node</h2>
</div>
<div id="triangle-judgement" class="section level2">
<h2>610. Triangle Judgement</h2>
</div>
<div id="shortest-distance-in-a-plane" class="section level2">
<h2>612. Shortest Distance in a Plane</h2>
</div>
<div id="shortest-distance-in-a-line" class="section level2">
<h2>613. Shortest Distance in a Line</h2>
</div>
<div id="second-degree-follower" class="section level2">
<h2>614. Second Degree Follower</h2>
</div>
<div id="average-salary-departments-vs-company" class="section level2">
<h2>615. Average Salary: Departments VS Company</h2>
</div>
<div id="students-report-by-geography" class="section level2">
<h2>618. Students Report By Geography</h2>
</div>
<div id="biggest-single-number" class="section level2">
<h2>619. Biggest Single Number</h2>
</div>
<div id="not-boring-movies" class="section level2">
<h2>620. Not Boring Movies</h2>
<p>X city opened a new cinema, many people would like to go to this cinema. The cinema also gives out a poster indicating the movies’ ratings and descriptions.</p>
<p>Please write a SQL query to output movies with an odd numbered ID and a description that is not ‘boring’. Order the result by rating.</p>
<p>For example, table <code>cinema</code>:</p>
<pre>
+---------+-----------+--------------+-----------+
|   id    | movie     |  description |  rating   |
+---------+-----------+--------------+-----------+
|   1     | War       |   great 3D   |   8.9     |
|   2     | Science   |   fiction    |   8.5     |
|   3     | irish     |   boring     |   6.2     |
|   4     | Ice song  |   Fantacy    |   8.6     |
|   5     | House card|   Interesting|   9.1     |
+---------+-----------+--------------+-----------+
</pre>
<p>For the example above, the output should be:</p>
<pre>
+---------+-----------+--------------+-----------+
|   id    | movie     |  description |  rating   |
+---------+-----------+--------------+-----------+
|   5     | House card|   Interesting|   9.1     |
|   1     | War       |   great 3D   |   8.9     |
+---------+-----------+--------------+-----------+
</pre>
<div id="solution-16" class="section level3">
<h3>Solution</h3>
<pre class="mysql"><code>select *
from cinema
where description != &quot;boring&quot; and id % 2 = 1
order by rating desc;</code></pre>
</div>
</div>
<div id="exchange-seats" class="section level2">
<h2>626. Exchange Seats</h2>
<p>Mary is a teacher in a middle school and she has a table <code>seat</code> storing students’ names and their corresponding seat ids. The column <strong>id</strong> is continuous increment.</p>
<p>Mary wants to change seats for the adjacent students.</p>
<p>Can you write a SQL query to output the result for Mary?</p>
<pre>
+---------+---------+
|    id   | student |
+---------+---------+
|    1    | Abbot   |
|    2    | Doris   |
|    3    | Emerson |
|    4    | Green   |
|    5    | Jeames  |
+---------+---------+
</pre>
<p>For the sample input, the output is:</p>
<pre>
+---------+---------+
|    id   | student |
+---------+---------+
|    1    | Doris   |
|    2    | Abbot   |
|    3    | Green   |
|    4    | Emerson |
|    5    | Jeames  |
+---------+---------+
</pre>
<p><strong>Note:</strong> If the number of students is odd, there is no need to change the last one’s seat.</p>
<div id="solution-17" class="section level3">
<h3>Solution</h3>
<pre class="mysql"><code>SELECT
    (CASE
        WHEN id%2!= 0 AND counts != id THEN id + 1
        WHEN id%2!= 0 AND counts = id THEN id
        ELSE id - 1
    END) AS id,
    student
FROM
    seat,
    (SELECT
        COUNT(*) AS counts
    FROM
        seat) AS seat_counts
ORDER BY id ASC;</code></pre>
</div>
</div>
<div id="swap-salary" class="section level2">
<h2>627. Swap Salary</h2>
<p>Given a table <code>salary</code>, such as the one below, that has m=male and f=female values. Swap all f and m values (i.e., change all f values to m and vice versa) with a <strong>single update statement</strong> and no intermediate temp table.</p>
<p>Note that you must write a single update statement, <strong>DO NOT</strong> write any select statement for this problem.</p>
<p><strong>Example:</strong></p>
<pre>
| id | name | sex | salary |
|----|------|-----|--------|
| 1  | A    | m   | 2500   |
| 2  | B    | f   | 1500   |
| 3  | C    | m   | 5500   |
| 4  | D    | f   | 500    |
</pre>
<p>After running your update statement, the above salary table should have the following rows:</p>
<pre>
| id | name | sex | salary |
|----|------|-----|--------|
| 1  | A    | f   | 2500   |
| 2  | B    | m   | 1500   |
| 3  | C    | f   | 5500   |
| 4  | D    | m   | 500    |
</pre>
<div id="solution-18" class="section level3">
<h3>Solution</h3>
<pre class="mysql"><code>update salary
set sex = case when sex = &quot;f&quot; then &quot;m&quot;
               when sex = &quot;m&quot; then &quot;f&quot;
               end</code></pre>
<hr />
<p>I also practiced adding table of contents in a blogdown post by setting the <code>output</code> parameter.</p>
<p>As Yihui mentions in this <a href="https://github.com/yihui/hugo-xmin/pull/7">pull request</a>, all you need to do is add this in YAML:</p>
<pre class="yaml"><code>output:
  blogdown::html_page:
    toc: true
    toc_depth: 2</code></pre>
<p><code>toc_depth: 2</code> means it will show up to 2 levels of headers.</p>
</div>
</div>
